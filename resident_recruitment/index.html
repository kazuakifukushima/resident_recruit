<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŒã‚“ãƒ»æ„ŸæŸ“ç—‡ã‚»ãƒ³ã‚¿ãƒ¼éƒ½ç«‹é§’è¾¼ç—…é™¢ - åˆæœŸç ”ä¿®åŒ»å‹Ÿé›†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            font-size: 2.5em;
            color: #2c5aa0;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }
        
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .form-title {
            font-size: 1.8em;
            color: #2c5aa0;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .required {
            color: #e74c3c;
        }
        
        .specialty-categories {
            margin-top: 15px;
        }
        
        .specialty-category {
            margin-bottom: 25px;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .category-title {
            color: #2c5aa0;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            padding-left: 12px;
        }
        
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: white;
            border: 1px solid #e1e5e9;
        }
        
        .checkbox-item:hover {
            background: rgba(102, 126, 234, 0.05);
            border-color: #667eea;
            transform: translateY(-1px);
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            transform: scale(1.2);
            accent-color: #667eea;
        }
        
        .checkbox-item span {
            font-size: 14px;
            color: #333;
            user-select: none;
        }
        
        .checkbox-item:has(input:checked) {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .checkbox-item:has(input:checked) span {
            color: #2c5aa0;
            font-weight: 600;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.8s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .welcome-message {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .video-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            font-size: 1.8em;
            color: #2c5aa0;
            margin-bottom: 20px;
            font-weight: bold;
            border-left: 5px solid #667eea;
            padding-left: 15px;
        }
        
        .video-placeholder {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }
        
        .video-placeholder:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .video-placeholder .play-icon {
            font-size: 4em;
            color: #667eea;
        }
        
        .video-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .video-description {
            color: #666;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .interview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .interview-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .interview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .interview-video {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            border: 2px dashed #dee2e6;
        }
        
        .photos-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .photo-placeholder {
            aspect-ratio: 3/4;
            background: linear-gradient(135deg, #f1f3f4 0%, #e8eaed 100%);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed #dadce0;
            transition: all 0.3s ease;
            padding: 20px;
            text-align: center;
        }
        
        .photo-placeholder:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .resident-card:hover {
            transform: translateY(-5px) !important;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2) !important;
            background: rgba(255,255,255,0.25) !important;
        }

        .resident-card:hover img {
            transform: scale(1.05) !important;
        }
        
        /* ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ  */
        .video-section [onclick]:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4) !important;
        }
        
        .interview-card [onclick]:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3) !important;
            border-color: #667eea !important;
        }
        
        @media (max-width: 1024px) {
            .photo-grid-top, .photo-grid-bottom {
                grid-template-columns: repeat(3, 1fr) !important;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .form-container, .video-section, .photos-section {
                padding: 20px;
            }
            
            .logo {
                font-size: 2em;
            }
            
            .interview-grid {
                grid-template-columns: 1fr;
            }
            
            .photo-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .photo-grid-top, .photo-grid-bottom {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        @media (max-width: 480px) {
            .photo-grid-top, .photo-grid-bottom {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸ¥ ãŒã‚“ãƒ»æ„ŸæŸ“ç—‡ã‚»ãƒ³ã‚¿ãƒ¼éƒ½ç«‹é§’è¾¼ç—…é™¢</div>
            <div class="subtitle">2025å¹´åº¦ ç ”ä¿®åŒ»å‹Ÿé›† - ç‰¹åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
        </div>
        
        <div id="content-section" class="content-section">
            <div class="welcome-message">
                <h2 style="color: #2c5aa0; margin-bottom: 15px;">ã‚ˆã†ã“ãã€<span id="welcome-name"></span>ã•ã‚“ï¼</h2>
                <p style="color: #666; font-size: 1.1em;">
                    å½“é™¢ã®ç ”ä¿®åŒ»ã«é–¢ã™ã‚‹ç‰¹åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã”ç”¨æ„ã„ãŸã—ã¾ã—ãŸã€‚<br>
                    å°†æ¥ã®åŒ»å¸«ã¨ã—ã¦ã®ã‚­ãƒ£ãƒªã‚¢ã‚’è€ƒãˆã‚‹å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚
                </p>
            </div>
            
            <div class="video-section">
                <h3 class="section-title">ğŸ¥ åŒ»å±€ã®æ§˜å­</h3>
                <div style="width: 100%; height: 350px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <!-- YouTubeåŸ‹ã‚è¾¼ã¿ï¼ˆä¿®æ­£ç‰ˆï¼‰ -->
                    <iframe width="100%" height="350" 
                            src="https://www.youtube-nocookie.com/embed/Xk5seGirfZQ?rel=0&modestbranding=1&enablejsapi=1&origin=https://claudeai.claude.ai" 
                            title="åŒ»å±€ã®æ§˜å­ - ç ”ä¿®åŒ»ã®æ—¥å¸¸" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowfullscreen
                            referrerpolicy="strict-origin-when-cross-origin"
                            style="border-radius: 12px;"
                            loading="lazy">
                    </iframe>
                </div>
                <div class="video-title">ç ”ä¿®åŒ»ã®æ—¥å¸¸ - åŒ»å±€ã§ã®ä¸€æ—¥</div>
                <div class="video-description">
                    å½“é™¢ã®ç ”ä¿®åŒ»ãŒå®Ÿéš›ã«åƒãåŒ»å±€ã®æ§˜å­ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚
                </div>
            </div>
            
            <div class="video-section">
                <h3 class="section-title">ğŸ¤ ç ”ä¿®åŒ»ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼</h3>
                <div class="interview-grid">
                    <div class="interview-card">
                        <div class="interview-video" style="width: 100%; height: 200px; border-radius: 8px; overflow: hidden;">
                            <!-- å®‰ç”°å…ˆç”Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å‹•ç”»ï¼ˆä¿®æ­£ç‰ˆï¼‰ -->
                            <iframe width="100%" height="200" 
                                    src="https://www.youtube-nocookie.com/embed/FfmE2Co7hgA?rel=0&modestbranding=1&enablejsapi=1" 
                                    title="å®‰ç”°å…ˆç”Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ - åˆæœŸç ”ä¿®åŒ»1å¹´ç›®" 
                                    frameborder="0" 
                                    allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                    allowfullscreen
                                    referrerpolicy="strict-origin-when-cross-origin"
                                    style="border-radius: 8px;"
                                    loading="lazy">
                            </iframe>
                        </div>
                        <div class="video-title">å®‰ç”°å…ˆç”Ÿï¼ˆåˆæœŸç ”ä¿®åŒ»1å¹´ç›®ï¼‰</div>
                        <div class="video-description">
                            ã€ŒåŸºç¤ç ”ç©¶ã¨æ„ŸæŸ“ç—‡ã¸ã®èˆˆå‘³ã‚’æ´»ã‹ã—ãŸé§’è¾¼ç—…é™¢ã§ã®å­¦ã³ã¨æˆé•·ã€
                        </div>
                    </div>
                    
                    <div class="interview-card">
                        <div class="interview-video" style="width: 100%; height: 200px; border-radius: 8px; overflow: hidden;">
                            <!-- é«˜æ©‹å…ˆç”Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å‹•ç”»ï¼ˆä¿®æ­£ç‰ˆï¼‰ -->
                            <iframe width="100%" height="200" 
                                    src="https://www.youtube-nocookie.com/embed/Kh1kfboJ398?rel=0&modestbranding=1&enablejsapi=1" 
                                    title="é«˜æ©‹å…ˆç”Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ - åˆæœŸç ”ä¿®åŒ»1å¹´ç›®" 
                                    frameborder="0" 
                                    allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                    allowfullscreen
                                    referrerpolicy="strict-origin-when-cross-origin"
                                    style="border-radius: 8px;"
                                    loading="lazy">
                            </iframe>
                        </div>
                        <div class="video-title">é«˜æ©‹å…ˆç”Ÿï¼ˆåˆæœŸç ”ä¿®åŒ»1å¹´ç›®ï¼‰</div>
                        <div class="video-description">
                            ã€Œå¸‚ä¸­ç—…é™¢ã§ä½“é¨“ã™ã‚‹å¤§å­¦ç—…é™¢ãƒ¬ãƒ™ãƒ«ã®æ•™è‚²ã¨ç ”ç©¶ç’°å¢ƒã€
                        </div>
                    </div>
                    
                    <div class="interview-card">
                        <div class="interview-video" style="width: 100%; height: 200px; border-radius: 8px; overflow: hidden;">
                            <!-- å°ç”°åŸå…ˆç”Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å‹•ç”»ï¼ˆä¿®æ­£ç‰ˆï¼‰ -->
                            <iframe width="100%" height="200" 
                                    src="https://www.youtube-nocookie.com/embed/7HDwyvWQ2lY?rel=0&modestbranding=1&enablejsapi=1" 
                                    title="å°ç”°åŸå…ˆç”Ÿã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ - åˆæœŸç ”ä¿®åŒ»2å¹´ç›®" 
                                    frameborder="0" 
                                    allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                    allowfullscreen
                                    referrerpolicy="strict-origin-when-cross-origin"
                                    style="border-radius: 8px;"
                                    loading="lazy">
                            </iframe>
                        </div>
                        <div class="video-title">å°ç”°åŸå…ˆç”Ÿï¼ˆåˆæœŸç ”ä¿®åŒ»2å¹´ç›®ï¼‰</div>
                        <div class="video-description">
                            ã€Œå¤šæ§˜ãªçµŒé¨“ã¨ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯ãªç’°å¢ƒãŒæˆé•·ã‚’ä¿ƒã™é§’è¾¼ç—…é™¢ã®ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆç”Ÿæ´»ã€
                        </div>
                    </div>
                </div>
            </div>
            
    <div class="photos-section" style="margin: 50px 0; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; position: relative; overflow: hidden;">
                <!-- èƒŒæ™¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%; z-index: 1;"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: rgba(255,255,255,0.05); border-radius: 50%; z-index: 1;"></div>
                
                <div style="position: relative; z-index: 2;">
                    <h3 class="section-title" style="text-align: center; margin-bottom: 15px; color: white; font-size: 2.2em; text-shadow: 0 2px 10px rgba(0,0,0,0.3);">ğŸ‘©â€âš•ï¸ ç ”ä¿®åŒ»ã®å…ˆç”Ÿé”ã®æ§˜å­</h3>
                    <p style="text-align: center; margin-bottom: 40px; color: rgba(255,255,255,0.9); font-size: 1.1em; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.6;">
                        å½“é™¢ã§æ´»èºã™ã‚‹ç ”ä¿®åŒ»ã®å…ˆç”Ÿæ–¹ã®æ§˜å­ã‚’ã”è¦§ãã ã•ã„ã€‚æ§˜ã€…ãªç§‘ã§ã®ç ”ä¿®ã‚’é€šã˜ã¦ã€ãã‚Œãã‚ŒãŒåŒ»å¸«ã¨ã—ã¦ã®å°‚é–€æ€§ã‚’é«˜ã‚ã¦ã„ã¾ã™ã€‚
                    </p>
                    
                    <!-- ä¸Šæ®µï¼š5æš -->
                    <div class="photo-grid-top" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 25px; max-width: 1200px; margin-left: auto; margin-right: auto;">
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident1.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident2.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident3.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident4.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident5.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                    </div>
                    
                    <!-- ä¸‹æ®µï¼š5æš -->
                    <div class="photo-grid-bottom" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; max-width: 1200px; margin-left: auto; margin-right: auto;">
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident6.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident7.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident8.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident9.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                        
                        <div class="resident-card" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            <img src="/image/resident10.jpg" alt="ç ”ä¿®åŒ»ã®å…ˆç”Ÿ" style="width: 100%; height: 180px; object-fit: cover; border-radius: 10px; transition: transform 0.3s ease;">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <h3 style="color: #2c5aa0; margin-bottom: 15px;">ãŠå•ã„åˆã‚ã›</h3>
                <p style="color: #666;">
                    è¦‹å­¦ãƒ»å®Ÿç¿’ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³é¢è«‡ã¯ä¸‹è¨˜ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚ˆã‚Šç”³ã—è¾¼ã¿ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚<br>
                    ğŸ“§ km_byoinkengaku@tmhp.jp<br>
                    ğŸ“ 03-3823-2101ï¼ˆç—…é™¢ä»£è¡¨ç•ªå·ï¼‰
                </p>
                <p style="color: #999; margin-top: 20px; font-size: 0.9em;">
                    Â© 2025 ãŒã‚“ãƒ»æ„ŸæŸ“ç—‡ã‚»ãƒ³ã‚¿ãƒ¼éƒ½ç«‹é§’è¾¼ç—…é™¢ ç ”ä¿®åŒ»æ¡ç”¨æ‹…å½“
                </p>
            </div>
        </div>
    </div>

    <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ‘ãƒãƒ«ï¼ˆç®¡ç†è€…ç”¨ãƒ»éè¡¨ç¤ºï¼‰ -->
<div id="admin-panel" style="display: none; position: fixed; bottom: 20px; right: 20px; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.2); z-index: 1000; min-width: 250px;">
<div style="display: flex; align-items: center; margin-bottom: 10px;">
<h4 style="color: #2c5aa0; margin: 0; font-size: 0.9em;">ğŸ“Š ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h4>
<button onclick="toggleAdminPanel()" style="margin-left: auto; background: none; border: none; font-size: 1.2em; cursor: pointer;">âœ•</button>
</div>

<div id="data-count" style="color: #666; font-size: 0.8em; margin-bottom: 10px;">
ç”³è¾¼ã¿ä»¶æ•°: <span id="count-display">0</span>ä»¶
</div>

<div style="display: flex; flex-direction: column; gap: 8px;">
<button onclick="downloadCSV()" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8em; transition: all 0.3s ease;">
ğŸ“„ CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
</button>
<button onclick="downloadJSON()" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8em; transition: all 0.3s ease;">
ğŸ“‹ JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
</button>
<button onclick="viewApplications()" style="background: #6f42c1; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8em; transition: all 0.3s ease;">
ğŸ‘ï¸ ãƒ‡ãƒ¼ã‚¿ä¸€è¦§è¡¨ç¤º
</button>
<button onclick="clearAllData()" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8em; transition: all 0.3s ease;">
ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
</button>
</div>
</div>

<!-- ãƒ‡ãƒ¼ã‚¿ä¸€è¦§è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="data-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center;">
<div style="background: white; border-radius: 15px; padding: 30px; max-width: 90%; max-height: 80%; overflow-y: auto; position: relative;">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
<h3 style="color: #2c5aa0; margin: 0;">ğŸ“Š ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h3>
<button onclick="closeModal()" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">âœ•</button>
</div>
<div id="data-content" style="overflow-x: auto;"></div>
</div>
</div>
</div>

<script>
// Google Sheets APIè¨­å®šï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¯¾å¿œç‰ˆï¼‰
const GOOGLE_SHEETS_CONFIG = {
    // ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ï¼ˆå®Ÿéš›ã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
    serviceAccount: {
        client_email: 'komagome-sheets-service@your-project.iam.gserviceaccount.com',
        private_key: '-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n',
        project_id: 'your-project-id'
    },
    spreadsheetId: 'YOUR_SPREADSHEET_ID_HERE', // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è¨­å®š
    range: 'A:H' // ãƒ‡ãƒ¼ã‚¿ç¯„å›²
};

// JWT Tokenç”Ÿæˆé–¢æ•°ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ç”¨ï¼‰
async function generateJWTToken() {
    const header = {
        alg: 'RS256',
        typ: 'JWT'
    };

    const now = Math.floor(Date.now() / 1000);
    const payload = {
        iss: GOOGLE_SHEETS_CONFIG.serviceAccount.client_email,
        scope: 'https://www.googleapis.com/auth/spreadsheets',
        aud: 'https://oauth2.googleapis.com/token',
        iat: now,
        exp: now + 3600 // 1æ™‚é–“æœ‰åŠ¹
    };

    try {
        // ã‚ˆã‚Šç°¡å˜ãªæ–¹æ³•ï¼šGoogle Apps ScriptçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹
        // è¤‡é›‘ãªJWTå®Ÿè£…ã®ä»£ã‚ã‚Šã«ã€ã‚·ãƒ³ãƒ—ãƒ«ãªWebã‚¢ãƒ—ãƒªæ–¹å¼ã‚’ä½¿ç”¨
        return null; // å¾Œè¿°ã®æ–¹æ³•ã‚’ä½¿ç”¨
    } catch (error) {
        console.error('JWTç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        return null;
    }
}

// ä¿®æ­£ç‰ˆï¼šGoogle Apps Script Webã‚¢ãƒ—ãƒªè¨­å®š
const WEBAPP_CONFIG = {
    // å®Ÿéš›ã®Google Apps Scriptã®Webã‚¢ãƒ—ãƒªURL
    webAppUrl: 'https://script.google.com/macros/s/AKfycbyFN1nTkw1oVIrjLCuu5-hcFmK6mebC5ugW2065pBIqpf_A7rgrCpkC9df8otxeYLYo/exec',
    // èªè¨¼ç”¨ã®ç§˜å¯†ã‚­ãƒ¼
    secretKey: 'komagome2025secret'
};

// HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã®æ—¢å­˜ã®sendToGoogleSheetsé–¢æ•°ã‚’ä»¥ä¸‹ã§å®Œå…¨ã«ç½®ãæ›ãˆ

// JSONPå®Œå…¨å®Ÿè£…ç‰ˆ sendToGoogleSheetsé–¢æ•°
async function sendToGoogleSheets(formData) {
    return new Promise((resolve) => {
        try {
            console.log('ğŸ“¤ JSONPå®Œå…¨å®Ÿè£…ç‰ˆã§Google Sheetsã«é€ä¿¡ä¸­...');
            console.log('ğŸ“‹ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', formData);
            
            // WebApp URL
            const webAppUrl = 'https://script.google.com/macros/s/AKfycbzkiGXHkIKHHjVW_VpX48EFt8fUJ-c4y2Dt996tlSTJtx1Zyq9s7oV-sowKzd7z-oJz/exec';
            const secretKey = 'komagome2025secret';
            
            // ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æº–å‚™
            const payload = {
                secretKey: secretKey,
                data: {
                    id: formData.id,
                    submittedAt: formData.submittedAt,
                    name: formData.name,
                    email: formData.email,
                    university: formData.university,
                    grade: formData.grade,
                    specialty: Array.isArray(formData.specialty) ? formData.specialty.join(', ') : formData.specialty,
                    message: formData.message || ''
                }
            };
            
            console.log('ğŸ“¦ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æº–å‚™å®Œäº†:', payload);
            
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åã‚’ç”Ÿæˆ
            const callbackName = 'jsonpCallback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8);
            console.log('ğŸ“ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å:', callbackName);
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ä½œæˆ
            window[callbackName] = function(response) {
                console.log('ğŸ“„ JSONP ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡:', response);
                
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢
                if (timeoutId) {
                    clearTimeout(timeoutId);
                }
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                try {
                    delete window[callbackName];
                    if (script && script.parentNode) {
                        document.head.removeChild(script);
                    }
                } catch (cleanupError) {
                    console.warn('âš ï¸ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', cleanupError);
                }
                
                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
                if (response && response.success) {
                    console.log('âœ… JSONPé€ä¿¡æˆåŠŸ!');
                    console.log('ğŸ“Š ä¿å­˜è¡Œç•ªå·:', response.rowNumber || 'ä¸æ˜');
                    console.log('ğŸ•’ ä¿å­˜æ™‚åˆ»:', response.timestamp || 'ä¸æ˜');
                    console.log('ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:', response.message || 'ä¸æ˜');
                    console.log('ğŸ”„ é€ä¿¡æ–¹å¼:', response.method || 'JSONP');
                    resolve(true);
                } else {
                    console.error('âŒ JSONPé€ä¿¡å¤±æ•—');
                    console.log('ğŸ“„ ã‚¨ãƒ©ãƒ¼è©³ç´°:', response?.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
                    console.log('ğŸ“‹ å®Œå…¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response);
                    resolve(false);
                }
            };
            
            // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ15ç§’ï¼‰
            const timeoutId = setTimeout(() => {
                console.error('âŒ JSONPé€ä¿¡ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ15ç§’ï¼‰');
                
                try {
                    delete window[callbackName];
                    if (script && script.parentNode) {
                        document.head.removeChild(script);
                    }
                } catch (e) {
                    console.warn('âš ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', e);
                }
                
                console.log('ğŸ’¡ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¾Œã®å¯¾å‡¦:');
                console.log('1. Google Apps ScriptãŒæ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª');
                console.log('2. ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã€Œå…¨å“¡ã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª');
                console.log('3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª');
                
                resolve(false);
            }, 15000);
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
            const dataParam = JSON.stringify(payload);
            const baseUrl = webAppUrl + '?callback=' + encodeURIComponent(callbackName);
            const dataUrlParam = '&data=' + encodeURIComponent(dataParam);
            const finalUrl = baseUrl + dataUrlParam;
            
            console.log('ğŸ”— ãƒªã‚¯ã‚¨ã‚¹ãƒˆURLé•·:', finalUrl.length);
            console.log('ğŸ”— URLæ¦‚è¦:', baseUrl + '&data=...');
            
            // URLãŒé•·ã™ãã‚‹å ´åˆã®è­¦å‘Š
            if (finalUrl.length > 2000) {
                console.warn('âš ï¸ URLé•·ãŒ2000æ–‡å­—ã‚’è¶…ãˆã¦ã„ã¾ã™:', finalUrl.length);
                console.log('ğŸ’¡ ãƒ‡ãƒ¼ã‚¿ã‚’çŸ­ç¸®ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
            }
            
            // ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¦ç´ ã‚’ä½œæˆ
            const script = document.createElement('script');
            script.async = true;
            script.crossOrigin = 'anonymous';
            
            // ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
            script.onload = function() {
                console.log('ğŸ“¦ JSONP ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†');
            };
            
            script.onerror = function(error) {
                console.error('âŒ JSONP ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢
                if (timeoutId) {
                    clearTimeout(timeoutId);
                }
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                try {
                    delete window[callbackName];
                } catch (e) {
                    console.warn('âš ï¸ ã‚¨ãƒ©ãƒ¼æ™‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', e);
                }
                
                console.log('ğŸ” ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ©ãƒ¼å¯¾å‡¦æ³•:');
                console.log('1. Google Apps Scriptã®WebApp URLãŒæ­£ã—ã„ã‹ç¢ºèª');
                console.log('2. Google Apps ScriptãŒæœ€æ–°ç‰ˆã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª');
                console.log('3. ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã€Œå…¨å“¡ã€ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª');
                console.log('4. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’ç¢ºèª');
                
                resolve(false);
            };
            
            // URLã‚’è¨­å®šã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ 
            script.src = finalUrl;
            document.head.appendChild(script);
            
            console.log('ğŸ“¤ JSONP ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å®Œäº†');
            console.log('â³ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾…æ©Ÿä¸­...');
            
        } catch (error) {
            console.error('âŒ JSONPé€ä¿¡æº–å‚™ã‚¨ãƒ©ãƒ¼:', error);
            console.error('ğŸ” ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯:', error.stack);
            resolve(false);
        }
    });
}

// ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ†ã‚¹ãƒˆé–¢æ•°
function testJSONPDirect() {
    console.log('ğŸ§ª ç›´æ¥JSONPãƒ†ã‚¹ãƒˆé–‹å§‹');
    
    const testData = {
        id: Date.now(),
        submittedAt: new Date().toLocaleString('ja-JP'),
        name: 'ç›´æ¥JSONPãƒ†ã‚¹ãƒˆ',
        email: 'direct-jsonp@test.com',
        university: 'ç›´æ¥JSONPå¤§å­¦',
        grade: 'åŒ»å­¦éƒ¨6å¹´',
        specialty: ['å†…ç§‘'],
        message: 'ç›´æ¥JSONPãƒ†ã‚¹ãƒˆå®Ÿè¡Œ'
    };
    
    console.log('ğŸ”¬ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿:', testData);
    
    sendToGoogleSheets(testData).then(success => {
        if (success) {
            console.log('ğŸ‰ ç›´æ¥JSONPãƒ†ã‚¹ãƒˆæˆåŠŸ!');
            console.log('ğŸ’¡ ã“ã‚Œã§å®Ÿéš›ã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚‚å‹•ä½œã™ã‚‹ã¯ãšã§ã™');
        } else {
            console.log('âŒ ç›´æ¥JSONPãƒ†ã‚¹ãƒˆå¤±æ•—');
            console.log('ğŸ”§ Google Apps Scriptã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
        }
    }).catch(error => {
        console.error('âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
    });
}

// ä½¿ç”¨æ–¹æ³•ãƒ­ã‚°
console.log('âœ… JSONPå®Œå…¨å®Ÿè£…ç‰ˆ sendToGoogleSheets é–¢æ•°ã‚’å®šç¾©ã—ã¾ã—ãŸ');
console.log('ğŸ“ ãƒ†ã‚¹ãƒˆæ–¹æ³•: testJSONPDirect() ã‚’å®Ÿè¡Œ');
console.log('ğŸ¯ ã“ã‚Œã§å®Ÿéš›ã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã§JSONPãŒä½¿ç”¨ã•ã‚Œã¾ã™');
   
// ãƒ‡ãƒ¼ã‚¿è“„ç©ç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let applicationData = [];

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
window.addEventListener('load', function() {
    const savedData = sessionStorage.getItem('hospitalApplications');
    if (savedData) {
        try {
            applicationData = JSON.parse(savedData);
            updateDataCount();
        } catch (e) {
            console.error('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            applicationData = [];
        }
    }
});

// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸï¼ˆãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãƒšãƒ¼ã‚¸ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ä¸è¦ï¼‰

// ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ©Ÿèƒ½ï¼ˆèªè¨¼ä»˜ãã‚»ã‚­ãƒ¥ã‚¢ç‰ˆï¼‰
let adminAuthenticated = false;
const ADMIN_PASSWORD = "komagome2025admin"; // ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰

function updateDataCount() {
    const countDisplay = document.getElementById('count-display');
    if (countDisplay) {
        countDisplay.textContent = applicationData.length;
    }
}

// ç®¡ç†è€…èªè¨¼é–¢æ•°
function authenticateAdmin(password) {
    if (password === ADMIN_PASSWORD) {
        adminAuthenticated = true;
        console.log('âœ… ç®¡ç†è€…èªè¨¼ã«æˆåŠŸã—ã¾ã—ãŸã€‚');
        console.log('åˆ©ç”¨å¯èƒ½ãªç®¡ç†ã‚³ãƒãƒ³ãƒ‰:');
        console.log('- showAdminPanel() : ç®¡ç†ãƒ‘ãƒãƒ«è¡¨ç¤º');
        console.log('- getApplicationData() : ãƒ‡ãƒ¼ã‚¿ä¸€è¦§è¡¨ç¤º');
        console.log('- exportCSVFromConsole() : CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰');
        console.log('- exportJSONFromConsole() : JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰');
        console.log('- logoutAdmin() : ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ');
        return true;
    } else {
        console.error('âŒ èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return false;
    }
}

// ç®¡ç†è€…ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
function logoutAdmin() {
    adminAuthenticated = false;
    const panel = document.getElementById('admin-panel');
    if (panel) {
        panel.style.display = 'none';
    }
    console.log('ğŸ”’ ç®¡ç†è€…ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚');
}

// èªè¨¼ãƒã‚§ãƒƒã‚¯ä»˜ãç®¡ç†ãƒ‘ãƒãƒ«è¡¨ç¤º
function showAdminPanel() {
    if (!adminAuthenticated) {
        console.error('âŒ ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦: ç®¡ç†è€…èªè¨¼ãŒå¿…è¦ã§ã™ã€‚');
        console.log('èªè¨¼æ–¹æ³•: authenticateAdmin("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰")');
        return false;
    }
    
    const panel = document.getElementById('admin-panel');
    if (panel) {
        panel.style.display = 'block';
        updateDataCount();
        console.log('âœ… ç®¡ç†ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤ºã—ã¾ã—ãŸã€‚ç·ãƒ‡ãƒ¼ã‚¿ä»¶æ•°:', applicationData.length);
    }
    return true;
}

// èªè¨¼ãƒã‚§ãƒƒã‚¯ä»˜ããƒ‡ãƒ¼ã‚¿ç¢ºèªé–¢æ•°
function getApplicationData() {
    if (!adminAuthenticated) {
        console.error('âŒ ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦: ç®¡ç†è€…èªè¨¼ãŒå¿…è¦ã§ã™ã€‚');
        console.log('èªè¨¼æ–¹æ³•: authenticateAdmin("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰")');
        return null;
    }
    
    console.log('=== ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ ===');
    console.log('ç·ä»¶æ•°:', applicationData.length);
    console.log('æœ€çµ‚æ›´æ–°:', new Date().toLocaleString('ja-JP'));
    
    if (applicationData.length > 0) {
        console.table(applicationData);
        console.log('=== ãƒ‡ãƒ¼ã‚¿è©³ç´° ===');
        applicationData.forEach((data, index) => {
            console.log(`ã€${index + 1}ã€‘`, {
                'ç”³è¾¼ID': data.id,
                'ç”³è¾¼æ—¥æ™‚': data.submittedAt,
                'åå‰': data.name,
                'ãƒ¡ãƒ¼ãƒ«': data.email,
                'å¤§å­¦': data.university,
                'å­¦å¹´': data.grade,
                'å¸Œæœ›ç§‘': data.specialty.join(', '),
                'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸': data.message || '(ãªã—)'
            });
        });
    } else {
        console.log('ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
    }
    
    return applicationData;
}

// èªè¨¼ãƒã‚§ãƒƒã‚¯ä»˜ãCSVå‡ºåŠ›é–¢æ•°
function exportCSVFromConsole() {
    if (!adminAuthenticated) {
        console.error('âŒ ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦: ç®¡ç†è€…èªè¨¼ãŒå¿…è¦ã§ã™ã€‚');
        console.log('èªè¨¼æ–¹æ³•: authenticateAdmin("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰")');
        return false;
    }
    
    if (applicationData.length === 0) {
        console.warn('âš ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return false;
    }
    
    downloadCSV();
    console.log('âœ… CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«å: ç ”ä¿®åŒ»ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿_' + new Date().toISOString().slice(0, 10) + '.csv');
    return true;
}

// èªè¨¼ãƒã‚§ãƒƒã‚¯ä»˜ãJSONå‡ºåŠ›é–¢æ•°
function exportJSONFromConsole() {
    if (!adminAuthenticated) {
        console.error('âŒ ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦: ç®¡ç†è€…èªè¨¼ãŒå¿…è¦ã§ã™ã€‚');
        console.log('èªè¨¼æ–¹æ³•: authenticateAdmin("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰")');
        return false;
    }
    
    if (applicationData.length === 0) {
        console.warn('âš ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return false;
    }
    
    downloadJSON();
    console.log('âœ… JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«å: ç ”ä¿®åŒ»ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿_' + new Date().toISOString().slice(0, 10) + '.json');
    return true;
}

// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: æœªèªè¨¼æ™‚ã®è­¦å‘Š
function checkUnauthorizedAccess() {
    if (!adminAuthenticated) {
        console.warn('ğŸ”’ ã“ã®ã‚µã‚¤ãƒˆã®ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã¯ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ã€‚');
        console.log('ç®¡ç†è€…ã®æ–¹ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§èªè¨¼ã—ã¦ãã ã•ã„:');
        console.log('authenticateAdmin("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰")');
    }
}

// éš ã—URLç®¡ç†æ©Ÿèƒ½ï¼ˆiPadã§ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰
function setupHiddenAdminURL() {
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç®¡ç†ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
    const urlParams = new URLSearchParams(window.location.search);
    const adminMode = urlParams.get('admin');
    const adminPass = urlParams.get('pass');
    
    // æ­£ã—ã„ç®¡ç†è€…URLã§ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆ
    if (adminMode === 'true' && adminPass === 'komagome2025') {
        showAdminInterface();
    }
}

// ç®¡ç†è€…ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¡¨ç¤º
function showAdminInterface() {
    // ç®¡ç†è€…ç”¨ã®UIã‚’ç”»é¢ä¸Šã«è¡¨ç¤º
    const adminUI = document.createElement('div');
    adminUI.id = 'mobile-admin-ui';
    adminUI.style.cssText = `
        position: fixed;
        top: 10px;
        left: 10px;
        right: 10px;
        background: rgba(255,255,255,0.98);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        z-index: 9999;
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        max-height: 80vh;
        overflow-y: auto;
    `;
    
    adminUI.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px;">
            <h3 style="margin: 0; color: #2c5aa0;">ğŸ“Š ç®¡ç†è€…ãƒ‘ãƒãƒ«</h3>
            <button onclick="closeAdminUI()" style="background: #dc3545; color: white; border: none; border-radius: 20px; width: 30px; height: 30px; cursor: pointer;">âœ•</button>
        </div>
        
        <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
            <strong>ğŸ“ˆ ç”³è¾¼ã¿çŠ¶æ³</strong><br>
            ç·ç”³è¾¼ã¿ä»¶æ•°: <span id="mobile-count" style="color: #28a745; font-weight: bold;">0</span>ä»¶<br>
            æœ€çµ‚æ›´æ–°: <span id="last-update">${new Date().toLocaleString('ja-JP')}</span>
        </div>
        
        <div style="display: grid; gap: 10px; margin-bottom: 15px;">
            <button onclick="mobileShowData()" style="background: #6f42c1; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px;">
                ğŸ‘ï¸ ãƒ‡ãƒ¼ã‚¿ä¸€è¦§è¡¨ç¤º
            </button>
            <button onclick="mobileDownloadCSV()" style="background: #28a745; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px;">
                ğŸ“„ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            </button>
            <button onclick="mobileDownloadJSON()" style="background: #17a2b8; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px;">
                ğŸ“‹ JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            </button>
            <button onclick="mobileClearData()" style="background: #dc3545; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px;">
                ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
            </button>
        </div>
        
        <div id="mobile-data-display" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: white; display: none;">
            <!-- ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        </div>
        
        <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 8px; font-size: 12px; color: #0066cc;">
            ğŸ’¡ <strong>ä½¿ã„æ–¹:</strong><br>
            ã“ã®ãƒšãƒ¼ã‚¸ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ã¦ç®¡ç†è€…å°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚<br>
            Google Sheetsã§ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã§ãã¾ã™ã€‚
        </div>
    `;
    
    document.body.appendChild(adminUI);
    updateMobileCount();
    
    // ç®¡ç†è€…ãƒ‘ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚ŒãŸã“ã¨ã‚’ãƒ­ã‚°
    console.log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ç®¡ç†è€…ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
}

// ãƒ¢ãƒã‚¤ãƒ«ç”¨ç®¡ç†æ©Ÿèƒ½
function updateMobileCount() {
    const countElement = document.getElementById('mobile-count');
    if (countElement) {
        countElement.textContent = applicationData.length;
    }
}

function closeAdminUI() {
    const adminUI = document.getElementById('mobile-admin-ui');
    if (adminUI) {
        adminUI.remove();
    }
}

function mobileShowData() {
    const displayArea = document.getElementById('mobile-data-display');
    if (!displayArea) return;
    
    if (applicationData.length === 0) {
        displayArea.innerHTML = '<p style="text-align: center; color: #666;">ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
        displayArea.style.display = 'block';
        return;
    }
    
    let html = '<div style="font-size: 12px;">';
    applicationData.forEach((data, index) => {
        html += `
            <div style="border-bottom: 1px solid #eee; padding: 8px 0; ${index % 2 === 0 ? 'background: #f9f9f9;' : ''} padding: 8px; margin-bottom: 5px; border-radius: 4px;">
                <strong>ã€${index + 1}ã€‘${data.name}</strong><br>
                ğŸ“§ ${data.email}<br>
                ğŸ« ${data.university} (${data.grade})<br>
                ğŸ©º ${data.specialty.join(', ')}<br>
                ğŸ“… ${data.submittedAt}<br>
                ${data.message ? `ğŸ’¬ ${data.message}` : ''}
            </div>
        `;
    });
    html += '</div>';
    
    displayArea.innerHTML = html;
    displayArea.style.display = 'block';
}

function mobileDownloadCSV() {
    if (applicationData.length === 0) {
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    downloadCSV();
    alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚');
}

function mobileDownloadJSON() {
    if (applicationData.length === 0) {
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    downloadJSON();
    alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚');
}

function mobileClearData() {
    if (applicationData.length === 0) {
        alert('å‰Šé™¤ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    if (confirm('ã™ã¹ã¦ã®ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        applicationData = [];
        sessionStorage.removeItem('hospitalApplications');
        updateMobileCount();
        const displayArea = document.getElementById('mobile-data-display');
        if (displayArea) {
            displayArea.style.display = 'none';
        }
        alert('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
    }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«éš ã—URLæ©Ÿèƒ½ã‚’ãƒã‚§ãƒƒã‚¯
window.addEventListener('load', function() {
    setupHiddenAdminURL();
});

function downloadCSV() {
    if (applicationData.length === 0) {
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    // CSVãƒ˜ãƒƒãƒ€ãƒ¼
    const headers = ['ID', 'ç”³è¾¼ã¿æ—¥æ™‚', 'åå‰', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', 'å¤§å­¦å', 'å­¦å¹´', 'å¸Œæœ›ç ”ä¿®ç§‘', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'];
    
    // CSVãƒ‡ãƒ¼ã‚¿ä½œæˆ
    const csvData = [
        headers.join(','),
        ...applicationData.map(data => [
            data.id,
            '"' + data.submittedAt + '"',
            '"' + data.name + '"',
            '"' + data.email + '"',
            '"' + data.university + '"',
            '"' + data.grade + '"',
            '"' + data.specialty.join('; ') + '"',
            '"' + (data.message || '') + '"'
        ].join(','))
    ].join('\n');
    
    // BOMã‚’è¿½åŠ ã—ã¦Excelã§æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
    const bom = '\uFEFF';
    const blob = new Blob([bom + csvData], { type: 'text/csv;charset=utf-8;' });
    
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', 'ç ”ä¿®åŒ»ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿_' + new Date().toISOString().slice(0, 10) + '.csv');
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function downloadJSON() {
    if (applicationData.length === 0) {
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    const jsonData = JSON.stringify(applicationData, null, 2);
    const blob = new Blob([jsonData], { type: 'application/json' });
    
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', 'ç ”ä¿®åŒ»ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿_' + new Date().toISOString().slice(0, 10) + '.json');
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function viewApplications() {
    if (applicationData.length === 0) {
        alert('è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    const modal = document.getElementById('data-modal');
    const content = document.getElementById('data-content');
    
    // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    let tableHTML = '<table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">';
    tableHTML += '<thead><tr style="background: #f8f9fa;">';
    tableHTML += '<th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">ID</th>';
    tableHTML += '<th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">ç”³è¾¼ã¿æ—¥æ™‚</th>';
    tableHTML += '<th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">åå‰</th>';
    tableHTML += '<th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">ãƒ¡ãƒ¼ãƒ«</th>';
    tableHTML += '<th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">å¤§å­¦</th>';
    tableHTML += '<th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">å­¦å¹´</th>';
    tableHTML += '<th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">å¸Œæœ›ç§‘</th>';
    tableHTML += '</tr></thead><tbody>';
    
    applicationData.forEach(data => {
        tableHTML += '<tr>';
        tableHTML += '<td style="border: 1px solid #dee2e6; padding: 8px;">' + data.id + '</td>';
        tableHTML += '<td style="border: 1px solid #dee2e6; padding: 8px;">' + data.submittedAt + '</td>';
        tableHTML += '<td style="border: 1px solid #dee2e6; padding: 8px;">' + data.name + '</td>';
        tableHTML += '<td style="border: 1px solid #dee2e6; padding: 8px;">' + data.email + '</td>';
        tableHTML += '<td style="border: 1px solid #dee2e6; padding: 8px;">' + data.university + '</td>';
        tableHTML += '<td style="border: 1px solid #dee2e6; padding: 8px;">' + data.grade + '</td>';
        tableHTML += '<td style="border: 1px solid #dee2e6; padding: 8px;">' + data.specialty.join(', ') + '</td>';
        tableHTML += '</tr>';
    });
    
    tableHTML += '</tbody></table>';
    content.innerHTML = tableHTML;
    modal.style.display = 'flex';
}

function closeModal() {
    document.getElementById('data-modal').style.display = 'none';
}

function clearAllData() {
    if (!adminAuthenticated) {
        console.error('âŒ ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦: ç®¡ç†è€…èªè¨¼ãŒå¿…è¦ã§ã™ã€‚');
        return false;
    }
    
    if (confirm('ã™ã¹ã¦ã®ç”³è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        applicationData = [];
        sessionStorage.removeItem('hospitalApplications');
        updateDataCount();
        console.log('âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        alert('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        return true;
    }
    return false;
}

function toggleAdminPanel() {
    if (!adminAuthenticated) {
        console.error('âŒ ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦: ç®¡ç†è€…èªè¨¼ãŒå¿…è¦ã§ã™ã€‚');
        return false;
    }
    
    const panel = document.getElementById('admin-panel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    return true;
}

// ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›æ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤ºã«ã™ã‚‹
document.querySelectorAll('input[type="text"], input[type="email"], select, textarea').forEach(input => {
    input.addEventListener('input', function() {
        const errorDiv = document.getElementById(this.id + '-error');
        if (errorDiv) {
            errorDiv.style.display = 'none';
            this.style.borderColor = '#e1e5e9';
        }
    });
});

// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´æ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤ºã«ã™ã‚‹
document.querySelectorAll('input[name="specialty"]').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const specialtyError = document.getElementById('specialty-error');
        const checkedBoxes = document.querySelectorAll('input[name="specialty"]:checked');
        if (checkedBoxes.length > 0) {
            specialtyError.style.display = 'none';
        }
    });
});

// YouTube iframe ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
function handleYouTubeError() {
    console.log('YouTubeåŸ‹ã‚è¾¼ã¿ã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ');
    
    // ã™ã¹ã¦ã®YouTube iframeã‚’æ¤œæŸ»
    const iframes = document.querySelectorAll('iframe[src*="youtube"]');
    
    iframes.forEach((iframe, index) => {
        iframe.addEventListener('error', function() {
            console.log('iframe ' + (index + 1) + ' ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            showFallback(iframe);
        });
        
        // èª­ã¿è¾¼ã¿å®Œäº†ã‚’ãƒã‚§ãƒƒã‚¯
        iframe.addEventListener('load', function() {
            console.log('iframe ' + (index + 1) + ' ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        });
    });
}

function showFallback(iframe) {
    const container = iframe.parentElement;
    const videoId = iframe.src.match(/embed\/([^?]+)/);
    const id = videoId ? videoId[1] : 'unknown';
    
    container.innerHTML = '<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #667eea; cursor: pointer; border: 2px dashed #dee2e6;" onclick="window.open(\'https://www.youtube.com/watch?v=' + id + '\', \'_blank\')">' +
        '<div style="font-size: 3.5em; margin-bottom: 10px;">ğŸ“º</div>' +
        '<div style="font-size: 1em; font-weight: bold; margin-bottom: 5px;">å‹•ç”»ã‚’è¦–è´</div>' +
        '<div style="font-size: 0.8em; color: #666; display: flex; align-items: center;">' +
        '<span style="margin-right: 5px;">â–¶ï¸</span>YouTubeã§é–‹ã</div>' +
        '</div>';
}

// ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ç›´æ¥è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ

// JSONPé€ä¿¡é–¢æ•°ã‚’å®šç¾©
async function sendToGoogleSheetsJSONP(formData) {
    return new Promise((resolve) => {
        try {
            console.log('ğŸ”„ JSONPæ–¹å¼ã§Google Sheetsã«é€ä¿¡ä¸­...');
            console.log('ğŸ“‹ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', formData);
            
            const webAppUrl = 'https://script.google.com/macros/s/AKfycbzBTW2INCuzbEcqpc9whSbXszlnytITkUkVZAigUxG-M2KB006qZSwekjHZ-pnbuJYx/exec';
            const secretKey = 'komagome2025secret';
            
            const payload = {
                secretKey: secretKey,
                data: {
                    id: formData.id,
                    submittedAt: formData.submittedAt,
                    name: formData.name,
                    email: formData.email,
                    university: formData.university,
                    grade: formData.grade,
                    specialty: Array.isArray(formData.specialty) ? formData.specialty.join(', ') : formData.specialty,
                    message: formData.message || ''
                }
            };
            
            const callbackName = 'jsonpCallback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
            console.log('ğŸ“ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å:', callbackName);
            
            window[callbackName] = function(response) {
                console.log('ğŸ“„ JSONP ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡:', response);
                
                try {
                    delete window[callbackName];
                    if (script && script.parentNode) {
                        document.head.removeChild(script);
                    }
                } catch (e) {
                    console.warn('âš ï¸ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', e);
                }
                
                if (response && response.success) {
                    console.log('âœ… JSONPé€ä¿¡æˆåŠŸ');
                    console.log('ğŸ“Š ä¿å­˜è¡Œç•ªå·:', response.rowNumber || 'ä¸æ˜');
                    console.log('ğŸ•’ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—:', response.timestamp || 'ä¸æ˜');
                    resolve(true);
                } else {
                    console.error('âŒ JSONPé€ä¿¡å¤±æ•—:', response?.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
                    console.log('ğŸ“„ å®Œå…¨ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response);
                    resolve(false);
                }
            };
            
            setTimeout(() => {
                console.error('âŒ JSONP ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ10ç§’ï¼‰');
                try {
                    delete window[callbackName];
                    if (script && script.parentNode) {
                        document.head.removeChild(script);
                    }
                } catch (e) {}
                resolve(false);
            }, 10000);
            
            const dataParam = JSON.stringify(payload);
            const url = webAppUrl + '?callback=' + encodeURIComponent(callbackName) + '&data=' + encodeURIComponent(dataParam);
            
            console.log('ğŸ”— URLé•·:', url.length);
            console.log('ğŸ”— ãƒªã‚¯ã‚¨ã‚¹ãƒˆURLï¼ˆå…ˆé ­200æ–‡å­—ï¼‰:', url.substring(0, 200) + '...');
            
            const script = document.createElement('script');
            script.src = url;
            script.async = true;
            
            script.onerror = function(error) {
                console.error('âŒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                try {
                    delete window[callbackName];
                } catch (e) {}
                resolve(false);
            };
            
            script.onload = function() {
                console.log('ğŸ“¦ JSONP ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†');
            };
            
            document.head.appendChild(script);
            console.log('ğŸ“¤ JSONP ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å®Œäº†');
            
        } catch (error) {
            console.error('âŒ JSONPé€ä¿¡æº–å‚™ã‚¨ãƒ©ãƒ¼:', error);
            resolve(false);
        }
    });
}

// ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®šç¾©
function testJSONPInBrowser() {
    console.log('ğŸ§ª ãƒ–ãƒ©ã‚¦ã‚¶JSONPãƒ†ã‚¹ãƒˆé–‹å§‹');
    
    const testData = {
        id: Date.now(),
        submittedAt: new Date().toLocaleString('ja-JP'),
        name: 'ãƒ–ãƒ©ã‚¦ã‚¶JSONPãƒ†ã‚¹ãƒˆ',
        email: 'browser-test@example.com',
        university: 'ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆå¤§å­¦',
        grade: 'åŒ»å­¦éƒ¨6å¹´',
        specialty: ['å†…ç§‘', 'å¤–ç§‘'],
        message: 'ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®JSONPãƒ†ã‚¹ãƒˆ'
    };
    
    console.log('ğŸ”¬ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿:', testData);
    
    sendToGoogleSheetsJSONP(testData).then(success => {
        if (success) {
            console.log('ğŸ‰ ãƒ–ãƒ©ã‚¦ã‚¶JSONPãƒ†ã‚¹ãƒˆæˆåŠŸ!');
            console.log('ğŸ’¡ Google Sheetsã§ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
        } else {
            console.log('âŒ ãƒ–ãƒ©ã‚¦ã‚¶JSONPãƒ†ã‚¹ãƒˆå¤±æ•—');
        }
    }).catch(error => {
        console.error('âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
    });
}

// ç°¡å˜ãªãƒ†ã‚¹ãƒˆé–¢æ•°
function simpleJSONPTest() {
    console.log('ğŸ”§ ç°¡å˜JSONPãƒ†ã‚¹ãƒˆé–‹å§‹');
    
    const callback = 'testCallback_' + Date.now();
    
    window[callback] = function(response) {
        console.log('ğŸ“„ ç°¡å˜ãƒ†ã‚¹ãƒˆçµæœ:', response);
        delete window[callback];
        
        if (response && response.message) {
            console.log('âœ… WebAppæ¥ç¶šæˆåŠŸ');
        }
    };
    
    const script = document.createElement('script');
    script.src = 'https://script.google.com/macros/s/AKfycbzBTW2INCuzbEcqpc9whSbXszlnytITkUkVZAigUxG-M2KB006qZSwekjHZ-pnbuJYx/exec?callback=' + callback + '&data=' + encodeURIComponent('{"test":"simple"}');
    
    document.head.appendChild(script);
    console.log('ğŸš€ ç°¡å˜ãƒ†ã‚¹ãƒˆé€ä¿¡å®Œäº†');
}

console.log('âœ… JSONPé–¢æ•°å®šç¾©å®Œäº†');
console.log('åˆ©ç”¨å¯èƒ½ãªé–¢æ•°:');
console.log('- testJSONPInBrowser() : å®Œå…¨ãªJSONPãƒ†ã‚¹ãƒˆ');
console.log('- simpleJSONPTest() : ç°¡å˜ãªæ¥ç¶šãƒ†ã‚¹ãƒˆ');
console.log('');
console.log('æœ€åˆã« simpleJSONPTest() ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™');    

</script>
</body>
</html>
